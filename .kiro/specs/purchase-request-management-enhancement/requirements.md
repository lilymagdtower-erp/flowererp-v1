# 구매 요청 관리 시스템 개선 요구사항

## 소개

기존 구매 요청 시스템을 개선하여 본사 관리자가 효율적으로 구매 요청을 취합하고 관리할 수 있도록 하며, 지점별 접근 권한을 분리하여 보안성을 향상시킵니다.

## 요구사항

### 요구사항 1: 자재 카테고리 표시 및 필터링 개선

**사용자 스토리:** 지점 직원으로서 자재를 선택할 때 카테고리를 명확히 보고 필터링할 수 있기를 원합니다.

#### 승인 기준
1. WHEN 자재 선택 표를 볼 때 THEN 각 자재의 카테고리가 표시되어야 합니다
2. WHEN 카테고리 드롭다운을 클릭할 때 THEN 실제 자재 데이터에서 추출한 모든 카테고리가 표시되어야 합니다
3. WHEN 특정 카테고리를 선택할 때 THEN 해당 카테고리의 자재만 필터링되어 표시되어야 합니다

### 요구사항 2: 구매 요청 취합 및 통합 관리

**사용자 스토리:** 본사 관리자로서 여러 지점의 구매 요청을 취합하여 효율적으로 관리하고 싶습니다.

#### 승인 기준
1. WHEN 구매 요청 목록을 선택할 때 THEN 지점별로 취합된 자재 목록이 표시되어야 합니다
2. WHEN 취합 화면을 볼 때 THEN 상품명, 거래처명, 가격, 각 지점별 수량이 표 형태로 표시되어야 합니다
3. WHEN 본사 관리자가 거래처명을 수정할 때 THEN 변경사항이 저장되어야 합니다
4. WHEN 본사 관리자가 가격을 수정할 때 THEN 변경사항이 저장되어야 합니다
5. WHEN 취합된 데이터를 볼 때 THEN 각 지점에서 신청한 수량이 명확히 구분되어 표시되어야 합니다

### 요구사항 3: 구매 요청 상태 관리

**사용자 스토리:** 본사 관리자로서 구매 요청의 상태를 단계별로 관리하고 싶습니다.

#### 승인 기준
1. WHEN 구매 요청 목록에서 요청을 선택할 때 THEN 상태 변경 옵션이 제공되어야 합니다
2. WHEN 상태를 변경할 때 THEN 유효한 상태 전이만 허용되어야 합니다
3. WHEN 상태가 변경될 때 THEN 관련 지점에 알림이 전송되어야 합니다
4. WHEN 상태 변경 이력을 볼 때 THEN 변경 시간과 담당자가 기록되어야 합니다

### 요구사항 4: 자재 가격 업데이트 연동

**사용자 스토리:** 본사 구매담당자로서 시장 상황에 맞게 가격을 수정하고 이를 자재 관리에 반영하고 싶습니다.

#### 승인 기준
1. WHEN 구매 요청에서 가격을 수정할 때 THEN 자재 관리 시스템의 기본 가격도 업데이트되어야 합니다
2. WHEN 가격 변경 이력을 볼 때 THEN 변경 전후 가격과 변경 사유가 기록되어야 합니다
3. WHEN 가격이 업데이트될 때 THEN 관련 지점에 가격 변경 알림이 전송되어야 합니다

### 요구사항 5: 구매 요청 상세 팝업 및 편집

**사용자 스토리:** 본사 관리자로서 구매 요청 목록에서 각 행을 클릭하여 상세 정보를 보고 편집하고 싶습니다.

#### 승인 기준
1. WHEN 구매 요청 목록의 행을 클릭할 때 THEN 상세 정보 팝업이 표시되어야 합니다
2. WHEN 팝업에서 거래처를 변경할 때 THEN 변경사항이 즉시 저장되어야 합니다
3. WHEN 팝업에서 가격을 변경할 때 THEN 변경사항이 즉시 저장되어야 합니다
4. WHEN 팝업을 닫을 때 THEN 변경사항이 목록에 반영되어야 합니다
5. WHEN 편집 권한이 없는 사용자가 팝업을 열 때 THEN 읽기 전용으로 표시되어야 합니다

### 요구사항 6: 역할 기반 메뉴 분리

**사용자 스토리:** 지점 직원으로서는 새 구매 요청만 생성할 수 있고, 본사 관리자로서는 모든 구매 요청을 관리할 수 있기를 원합니다.

#### 승인 기준
1. WHEN 지점 직원이 로그인할 때 THEN "새 구매 요청" 메뉴만 표시되어야 합니다
2. WHEN 본사 관리자가 로그인할 때 THEN "구매 요청 관리" 메뉴가 표시되어야 합니다
3. WHEN 지점 직원이 구매 요청 관리 URL에 직접 접근할 때 THEN 접근이 차단되어야 합니다
4. WHEN 본사 관리자가 구매 요청 관리에 접근할 때 THEN 모든 지점의 요청을 볼 수 있어야 합니다
5. WHEN 사용자 역할이 변경될 때 THEN 메뉴 접근 권한이 즉시 반영되어야 합니다

### 요구사항 7: 취합 데이터 시각화

**사용자 스토리:** 본사 관리자로서 구매 요청 데이터를 시각적으로 이해하기 쉽게 보고 싶습니다.

#### 승인 기준
1. WHEN 취합 화면을 볼 때 THEN 지점별 요청 수량이 컬러 코딩되어 표시되어야 합니다
2. WHEN 총 수량이 많은 자재일 때 THEN 우선순위가 높게 표시되어야 합니다
3. WHEN 긴급 요청이 포함된 자재일 때 THEN 특별한 표시가 되어야 합니다
4. WHEN 취합 데이터를 내보낼 때 THEN Excel 형태로 다운로드할 수 있어야 합니다

### 요구사항 8: 실시간 알림 시스템

**사용자 스토리:** 구매 요청 관련 변경사항이 발생할 때 관련자들에게 실시간으로 알림을 받고 싶습니다.

#### 승인 기준
1. WHEN 새 구매 요청이 제출될 때 THEN 본사 관리자에게 알림이 전송되어야 합니다
2. WHEN 구매 요청 상태가 변경될 때 THEN 해당 지점에 알림이 전송되어야 합니다
3. WHEN 가격이 변경될 때 THEN 관련 지점에 알림이 전송되어야 합니다
4. WHEN 긴급 요청이 제출될 때 THEN 즉시 알림이 전송되어야 합니다

## 기술적 제약사항

1. 기존 Firebase Firestore 구조와 호환되어야 합니다
2. 현재 사용 중인 React Hook Form과 Zod 검증을 유지해야 합니다
3. 기존 UI 컴포넌트 라이브러리를 활용해야 합니다
4. 모바일 반응형 디자인을 지원해야 합니다

## 성능 요구사항

1. 취합 데이터 로딩 시간은 3초 이내여야 합니다
2. 실시간 알림은 1초 이내에 전달되어야 합니다
3. 대량 데이터(1000건 이상) 처리 시에도 UI가 멈추지 않아야 합니다

## 보안 요구사항

1. 역할 기반 접근 제어가 서버 사이드에서 검증되어야 합니다
2. 가격 변경 이력이 감사 로그로 기록되어야 합니다
3. 민감한 데이터는 암호화되어 저장되어야 합니다